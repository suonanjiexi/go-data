# Cyber-DB 数据库

一个用Go语言实现的去中心化高性能分布式关系型数据库系统。
## 主要特性

- **高性能存储引擎**：自研高性能存储引擎，支持快速读写和高效存储
- **分布式架构**：支持水平扩展和分片，自动数据分布与负载均衡
- **分布式事务支持**：包含2PC和3PC，以及TCC的实现
- **高并发**：细粒度锁和无锁数据结构，支持百万级QPS
- **高可用性**：自动故障转移和数据复制，支持多副本一致性
- **B+树索引**：高效的数据检索，支持复合索引和自适应索引
- **监控和管理**：完整的监控和管理接口，支持可视化监控

## 功能特性

- 基本的数据存储和检索
- 支持丰富的SQL语法
  - 基本的CRUD操作（创建、读取、更新、删除）
  - 条件查询（WHERE子句）
  - 多条件组合查询（AND/OR）
  - 模糊匹配查询（LIKE操作符）
  - 结果排序（ORDER BY）
  - 分页查询（LIMIT/OFFSET）
  - 分组统计（GROUP BY）
  - 聚合函数（MAX、MIN、SUM、AVG、COUNT）
  - 支持ID自增和唯一性约束
  - 支持子查询和JOIN操作
  - 支持视图创建和管理
  - 支持DDL语句（CREATE、ALTER、DROP）
- 高效索引
  - 优化的B+树索引结构
  - 支持哈希索引和位图索引
  - 支持普通索引和唯一索引
  - 支持多列复合索引
  - 高性能范围查询
  - 并发安全的索引访问
  - 自动索引维护和优化
  - 索引使用统计和建议
- 事务管理
  - 完整的ACID事务支持
  - 多种隔离级别（读未提交、读已提交、可重复读、串行化）
  - 死锁检测和自动处理
  - 事务超时和自动回滚机制
  - 基于MVCC的并发控制
  - 写集合和读集合管理
  - 两阶段锁定协议
  - 分布式事务支持 两阶段提交协议（2PC）和三阶段提交协议（3PC）
  - 事务超时管理
  - 故障恢复机制
  - 事务状态追踪
  - 分布式一致性保证
  - 事务日志和回放
- 锁机制
  - 支持读锁和写锁
  - 锁升级和降级
  - 死锁检测和预防
  - 超时自动释放
  - 等待队列管理
  - 锁粒度优化
  - 意向锁支持
  - 分布式锁协调
- 并发控制
  - 多版本并发控制（MVCC）
  - 乐观并发控制
  - 悲观并发控制
  - 事务隔离保证
  - 并发度优化
  - 资源竞争管理
  - 无锁数据结构
  - 原子操作支持
- 持久化存储
  - 数据持久化到磁盘
  - 可配置数据存储路径
  - 崩溃恢复机制
  - 数据一致性保证
  - 日志记录和回放
  - 数据压缩和优化
  - 增量备份和全量备份
  - 时间点恢复
- 分布式特性
  - 数据分片和路由
  - 一致性哈希分片
  - 范围分片支持
  - 分片自动再平衡
  - 跨分片查询优化
  - 分片数据迁移
  - 集群成员管理
  - 自动故障检测
- 网络服务接口
  - TCP协议通信
  - 支持多客户端并发连接
  - 连接超时管理
  - 高性能并发处理
  - 连接池管理
  - 负载均衡
  - 动态节点管理
  - 自动故障转移
  - 数据分片路由
  - 负载监控和调整
  - 支持TLS加密通信
  - 客户端认证和授权
- 监控与管理
  - 实时性能监控
  - 资源使用统计
  - 慢查询分析
  - 查询优化建议
  - 系统告警机制
  - 可视化管理界面
  - 操作审计日志

## 项目结构

- `cmd/`: 命令行工具
  - `cyberdb/`: 数据库服务器程序
  - `admin/`: 管理工具
  - `benchmark/`: 性能测试工具
- `pkg/`: 核心包
  - `storage/`: 存储引擎，负责数据的持久化存储
  - `parser/`: SQL解析器，解析和验证SQL语句
  - `transaction/`: 事务管理，处理事务的开始、提交和回滚
  - `server/`: 网络服务，处理客户端连接和请求
  - `cluster/`: 集群管理，处理节点通信和协调
  - `index/`: 索引管理，提供高效的数据检索
  - `metrics/`: 性能指标收集和监控
  - `admin/`: 管理接口和工具
- `examples/`: 示例代码
  - 包含客户端示例程序
  - 提供SQL使用示例
  - 分布式部署示例
  - 高级功能演示

## 快速开始

1. 编译服务器：
```bash
go build -o cyberdb ./cmd/cyberdb
```

2. 运行服务器：
```bash
# 使用默认配置
./cyberdb

# 或指定配置
./cyberdb -host 127.0.0.1 -port 3306 -db ./mydata
```

3. 使用客户端连接：
```bash
# 编译并运行示例客户端
go build -o client ./examples/client.go
./client

# 运行测试示例
./client --test
```
4. 启动集群模式：
```bash
# 启动第一个节点（作为种子节点）
./cyberdb -cluster-mode -node-id node1 -cluster-addr 127.0.0.1:7001

# 启动其他节点并加入集群
./cyberdb -cluster-mode -node-id node2 -cluster-addr 127.0.0.1:7002 -join 127.0.0.1:7001
./cyberdb -cluster-mode -node-id node3 -cluster-addr 127.0.0.1:7003 -join 127.0.0.1:7001
```

更多详细信息和使用示例，请参考 `examples/README.md`。

## 性能指标
- 单节点模式下支持 10万+ QPS
- 集群模式下可线性扩展至 100万+ QPS
- 毫秒级查询响应时间
- 支持TB级数据存储
- 99.9% 的高可用性保证
- 支持数百节点规模的集群

## 注意事项

1. 确保防火墙允许指定端口的TCP连接
2. 数据库文件路径需要有写入权限
3. 使用Ctrl+C可以优雅地关闭服务器
4. 默认事务超时时间为30秒
5. 客户端连接超时时间为5分钟
6. 事务隔离级别默认为可重复读（RepeatableRead）
7. 死锁检测会自动中止较新的事务
8. 超时的事务会被自动清理
9. 建议在高并发场景下使用合适的索引
10. 大型事务建议适当调整超时时间
11. 集群模式下建议至少部署3个节点以保证高可用性
12. 定期备份数据以防止意外数据丢失

## 贡献

欢迎提交Issue和Pull Request来帮助改进项目。

## 许可证
本项目采用 MIT 许可证。详情请参阅 LICENSE 文件。
